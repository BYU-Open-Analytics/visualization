<?php
if ( $context->valid ) {
?>

<!-- Welcome jumbotron message -->
<div class="jumbotron" id="welcomeJumbotron">
  <h1>Welcome!</h1>
  <p>This dashboard will display recommendations to you about which videos and quizzes should be reviewed, based on your online activity.</p>
  <p><button class="btn btn-primary btn-large" data-dismiss="welcomeJumbotron" id="jumbotronDismiss">Continue to Dashboard</button></p>
</div>

<!-- Container for concepts, recommendations, and advanced -->
<div id="mainContainer" class="container">
  <div class="row">
    <div class="col-sm-9"><div class="row">

      <!-- Concepts -->
      <div id="conceptsSection" class="advancedSimple advancedAll col-md-12">
        <div class="row">
	  <div class="col-sm-6">
            <h3>Strongest Concepts</h3>
            <span class="spinner"><?php echo Phalcon\Tag::image("img/spinner.svg"); ?><br /></span>
              <ul id="strongestConceptsList"> </ul>
          </div>
	  <div class="col-sm-6">
            <h3>Weakest Concepts</h3>
            <span class="spinner"><?php echo Phalcon\Tag::image("img/spinner.svg"); ?><br /></span>
              <ul id="weakestConceptsList"> </ul>
          </div>
        </div>
      </div>
  
      <!-- Recommendations -->
      <div id="recommendSection" class="advancedSimple advancedAll col-md-12">
          <h3 class="advancedSimple">Recommendations</h3>
          <h3 class="advancedAll">Recommendations for all concepts</h3>
          <div class="panel-group" id="recommendationsAccordion" role="tablist">
            <!-- Group 1 -->
            <div class="panel panel-default">
              <div class="panel-heading">
  	      <h4 class="panel-title">
                  <a role="button" data-toggle="collapse" data-parent="#recommendationsAccordion" href="#recommend1">Try these quiz questions
  	        <span class="recommendInfo" id="recommend1Info" data-toggle="tooltip" title="These questions were selected because you have not attempted them yet. This material will likely be on an upcoming exam, so to improve your score, it is recommended that you practice these questions."><span class="glyphicon glyphicon-info-sign"></span></span></a>
                </h4>
              </div>
              <div id="recommend1" class="panel-collapse collapse in">
                <div class="panel-body recommendPanelBody">
                  <span class="spinner"><?php echo Phalcon\Tag::image("img/spinner.svg"); ?><br /></span>
                  <table class="table" id="recommend1List"> </table>
                </div>
              </div>
            </div>
            <!-- Group 2 -->
            <div class="panel panel-default">
              <div class="panel-heading">
  	      <h4 class="panel-title">
                  <a role="button" data-toggle="collapse" data-parent="#recommendationsAccordion" href="#recommend2">Watch videos before attempting these quiz questions
  	        <span class="recommendInfo" id="recommend2Info" data-toggle="tooltip" title="These questions were selected because, based on your online activity, it seems you did not watch the videos before you attempted the quiz. To better learn the material, it is recommended that you watch the videos associated with these quiz questions."><span class="glyphicon glyphicon-info-sign"></span></span></a>
                </h4>
              </div>
              <div id="recommend2" class="panel-collapse collapse">
                <div class="panel-body recommendPanelBody">
                  <table class="table" id="recommend2List"> </table>
                </div>
              </div>
            </div>
            <!-- Group 3 -->
            <div class="panel panel-default">
              <div class="panel-heading">
  	      <h4 class="panel-title">
                  <a role="button" data-toggle="collapse" data-parent="#recommendationsAccordion" href="#recommend3">Find additional help
  	        <span class="recommendInfo" id="recommend3Info" data-toggle="tooltip" title="These questions were selected because you have spent time watching the videos, but for some reason, the quiz was still difficult for you. To learn this material, you may want to email the instructor, go into the TA lab, or ask a friend to help you out."><span class="glyphicon glyphicon-info-sign"></span></span></a>
                </h4>
              </div>
              <div id="recommend3" class="panel-collapse collapse">
                <div class="panel-body recommendPanelBody">
                  <table class="table" id="recommend3List"> </table>
                </div>
              </div>
            </div>
            <!-- Group 4 -->
            <div class="panel panel-default">
              <div class="panel-heading">
  	      <h4 class="panel-title">
                  <a role="button" data-toggle="collapse" data-parent="#recommendationsAccordion" href="#recommend4">Practice these questions again
  	        <span class="recommendInfo" id="recommend4Info" data-toggle="tooltip" title="These questions were selected because even though you eventually answered it correctly, you missed them multiple times at first. These questions are recommended you to re-do to help you solidify your understanding."><span class="glyphicon glyphicon-info-sign"></span></span></a>
                </h4>
              </div>
              <div id="recommend4" class="panel-collapse collapse">
                <div class="panel-body recommendPanelBody">
                  <table class="table" id="recommend4List"> </table>
                </div>
              </div>
            </div>
  
         </div>
      </div>
  
     
      
      <div id="templates" class="hidden">
        <table id="recommendTemplates">
        <!-- Template for recommendation table header -->
        <thead class="recommendHeaderTemplate">
          <tr>
            <th>Quiz Question</th>
            <th><span class="advancedMore">Correct</span></th>
            <th><span class="advancedMore">Attempts</span></th>
            <th><span class="advancedMoreClass">Class Average</span></th>
            <!--<th><span class="advancedMoreClass">Class Average</span></th>-->
            <th><!--Launch Quiz--></th>
            <th><!--See Related Videos--></th>
          </tr>
        </thead>
        <!-- Template for recommendation item -->
        <tr class="recommendQuestionDisplay">
  	  <td>{display}</td>
	  <td><span class="advancedMore correct-{correct}Holder"><span class="label label-danger label-incorrect">Incorrect</span><span class="label label-success label-correct">Correct</span></span></td>
	  <td><span class="advancedMore"><span class="label label-default">{attempts} attempts</span></span></td>
  	  <td><span class="advancedMoreClass"><span class="label label-success">{classPercentCorrect}% Correct</span> <span class="label label-default">{classAverageAttempts} attempts</span></span></td>
          <td><button class="btn btn-info btn-xs" data-toggle="modal" data-target="#questionLaunchModal" data-assessment="{assessment_id}" data-question="{question_id}"> <span class="glyphicon glyphicon-log-in"></span> Launch Quiz </button></td>
  	  <td><button class="btn btn-info btn-xs" data-toggle="modal" data-target="#relatedVideosModal" data-assessment="{assessment_id}" data-question="{question_id}"> <span class="glyphicon glyphicon-film"></span> See Related Videos </button></td>
        </tr>
        </table>
      </div>
      
<!--
  	<div class="recommendQuestionInfoTable">
  	  <span class="advancedMore">
              <span class="advancedMoreClass pull-left">You: &nbsp;</span>
  	    <span class="label label-success">Correct</span>
  	    <span class="label label-default">{attempts} attempts</span><br>
  	  </span>
            <span class="advancedMoreClass">
              <span class="advancedMoreClass pull-left">Class Average: </span>
  	    <span class="label label-success">{classPercentCorrect}% Correct</span>
              <span class="label label-default">{classAverageAttempts} attempts</span><br>
            </span>
          </div>
  	<button class="btn btn-info btn-xs" data-toggle="modal" data-target="#questionLaunchModal" data-assessment="{assessment_id}" data-question="{question_id}">
  	  <span class="glyphicon glyphicon-log-in"></span> Launch Quiz
  	</button>
  	<button class="btn btn-info btn-xs" data-toggle="modal" data-target="#relatedVideosModal" data-assessment="{assessment_id}" data-question="{question_id}">
  	  <span class="glyphicon glyphicon-film"></span> See Related Videos
  	</button>
        </span>
      </div> -->
  
  
      <!-- Scatterplot -->
      <div id="scatterplotSection" class="advancedScatterplot col-md-12">
        <h3>Scatterplot</h3>
          <span class="spinner pull-right"><?php echo Phalcon\Tag::image("img/spinner.svg"); ?><br /></span>
          <form>
            <div class="btn-group" data-toggle="buttons">
  	    <label class="btn btn-default active scopeOptionLabel"><input type="radio" name="scatterplotScopeOption" value="concept" checked />Concept: 
  
              </label>
  	    <label class="btn btn-default scopeOptionLabel"><input type="radio" name="scatterplotScopeOption" value="chapter" />Chapter: 
  	
              </label>
  	    <label class="btn btn-default scopeOptionLabel"><input type="radio" name="scatterplotScopeOption" value="unit" />Unit: 
                <select class="unitSelector" name="scatterplotUnitSelector">
                  <?php print_r($units); foreach ($units as $unit) { echo '<option value="'.$unit['id'].'">'.$unit['name'].'</option>'; } ?>
                </select>
              </label>
              <label class="btn btn-default scopeOptionLabel"><input type="radio" name="scatterplotScopeOption" value="all" />All</label>
            </div>
          </form>
      </div>
  
      <!-- Concept Mastery Graph -->
      <div id="masteryGraphSection" class="advancedMasteryGraph col-md-12">
        <h3>Concept Mastery Graph <small>—Scores still need to be scaled by class once we have actual data</small></h3>
          <span class="spinner pull-right"><?php echo Phalcon\Tag::image("img/spinner.svg"); ?><br /></span>
          <form>
            <div class="btn-group" data-toggle="buttons">
              <label class="btn btn-default active"><input type="radio" name="masteryGraphScopeOption" value="chapter" checked />Chapter</label>
              <label class="btn btn-default"><input type="radio" name="masteryGraphScopeOption" value="unit" />Unit</label>
              <label class="btn btn-default"><input type="radio" name="masteryGraphScopeOption" value="all" />All</label>
            </div>
          </form><br><br>
  	<div class="svgContainer"></div>
      </div>

    </div></div>

    <!-- Advanced -->
    <div id="advancedSection" class="col-sm-3">
      <h3>Advanced</h3>
      <ul class="nav nav-pills nav-stacked">
        <li role="presentation" class="advancedToggleLi active"><a id="advancedToggleSimple" class="advancedToggle" data-option="simple" href="#">See simple view</a></li>
        <li role="presentation" class="advancedToggleLi"><a id="advancedToggleMore" class="advancedToggle" data-option="more" href="#">See more details</a><div class="advancedToggleOptional"><input id="advancedToggleMoreClass" class="advancedToggleOptional" data-option="moreClass" type="checkbox" />&nbsp;<label for="advancedToggleMoreClass">Compare to class</label></div></li>
        <li role="presentation" class="advancedToggleLi"><a id="advancedToggleScatterplot" class="advancedToggle" data-option="scatterplot" href="#">See scatterplot for these concepts</a><div class="advancedToggleOptional"><input id="advancedToggleScatterplotClass" class="advancedToggleOptional" data-option="scatterplotClass" type="checkbox" />&nbsp;<label for="advancedToggleScatterplotClass">Compare to class</label></div></li>
        <li role="presentation" class="advancedToggleLi"><a id="advancedToggleMasteryGraph" class="advancedToggle" data-option="masteryGraph" href="#">See my concept mastery graph</a></li>
        <li role="presentation" class="advancedToggleLi"><a id="advancedToggleAll" class="advancedToggle" data-option="all" href="#">See all recommendations for all concepts</a></li>
      </ul>
    </div>

  </div>
</div>

<!-- Quiz launch modal dialog -->
<div class="modal fade" tabindex="-1" id="questionLaunchModal">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">This quiz is for practice only.</h4>
			</div>
			<div class="modal-body">
				To have this quiz count for your grade, launch this quiz through Learning Suite.
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Do not launch</button>
				<a href="#" target="_blank" id="questionLaunchContinueButton" type="button" class="btn btn-primary">Continue to practice</a>
			</div>
		</div>
	</div>
</div>

<!-- Related videos modal dialog -->
<div class="modal fade" tabindex="-1" id="relatedVideosModal">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Videos related to this question</h4>
			</div>
			<div class="modal-body">
				<table class="table" id="relatedVideosModalTable">
					<thead><tr><th>&nbsp;</th><th>Video Name</th><th class="advancedMore">% Watched</th></tr></thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<!-- This is the existing content recommender stuff -->
<!-- Content tables -->
<div id="mainContainer" class="container hidden">
  <div class="row">
    <div id="questionsTable" class="col-md-6">
      <div class=""><h3>Quiz Questions <small>— Sorted by attempts</small></h3></div>
      <span class="spinner"><?php echo Phalcon\Tag::image("img/spinner.svg"); ?><br /></span>
      <table class="table table-striped table-hover">
      </table>
    </div>
    <div id="videosTable" class="col-md-6">
      <h3 class="">Videos <small>— Only showing required</small></h3>
      <table class="table table-striped table-hover">
        <colgroup><col><col><col class="colWatched"></colgroup>
        <thead><tr><th>&nbsp;</th><th>Video Name</th><th>% Watched</th></tr></thead>
	<tbody></tbody>
      </table>
      <span class="spinner"><?php echo Phalcon\Tag::image("img/spinner.svg"); ?><br /></span>
    </div>
  </div>
</div>


<?php
echo Phalcon\Tag::javascriptInclude("js/vendor/jquery.knob.min.js");
echo Phalcon\Tag::javascriptInclude("js/content_recommender.js");
echo Phalcon\Tag::stylesheetLink("css/content_recommender.css");

} else {
	echo "<p class='alert alert-danger'>Not logged in, or there was an LTI error. Try launching this app again.</p>";
}

